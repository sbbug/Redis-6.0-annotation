

## Redis事物原理:

#### 事物相关命令

    multi 标记一个事物开始
    exec  执行队列里所有命令
    watch 监视一个或者多个key,如果在事物执行之前这个key被其它命令修改。
    那么整个事物被修改。
    unwatch 取消对key的监视
    discard 取消事物，放弃执行。刷新命令队列。
    
    Redis事物不支持回滚
    
#### 事物执行机制

    所有在队列里的命令都将被串行化分别执行。同时在执行事物命令的过程中，另一个客户端发送的命令
    将不会被执行。保证了执行的隔离性。

#### 事物出错

    1、事物中的某个命令无法加入队列。比如命令语法错误等
    这种错误Redis会在客户端提前进行校验，如果出错，直接报错。
        MULTI
        +OK
        INCR a b c
        -ERR wrong number of arguments for 'incr' command
    2、命令执行过程中出错
    即使某个命令出现错误，仍然不影响其它命令执行。
    
#### 乐观锁
    
    watch对于Redis事物提供了一个CAS机制
    使用watch来监听指定的key,如果在exec之前，某个key被修改了，那么整个事物终止执行。
    和Java中CAS(先比较再交换)机制非常相似。
    watch机制主要考虑多个客户端同时操作一个key，就会产生竞争条件，因此需要确保key的安全性。
 
    
 
    
    
    
    